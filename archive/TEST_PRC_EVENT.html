<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ä¸­å›½æˆç«‹äº‹ä»¶æµ‹è¯• - History River</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e40af;
            margin-bottom: 10px;
        }
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .status.warning {
            background: #fef3c7;
            color: #92400e;
        }
        .event-info {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .event-data {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            font-weight: 600;
        }
        button:hover {
            background: #1d4ed8;
        }
        button.success {
            background: #059669;
        }
        button.warning {
            background: #d97706;
        }
        #test-result {
            margin-top: 20px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
        }
        .tips {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin: 20px 0;
        }
        .tips h3 {
            color: #065f46;
            margin-top: 0;
        }
        .tips ul {
            color: #047857;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‡¨ğŸ‡³ æ–°ä¸­å›½æˆç«‹äº‹ä»¶æµ‹è¯•</h1>
        <p>ç¡®ä¿1949å¹´"æ–°ä¸­å›½æˆç«‹"äº‹ä»¶åœ¨æ¯æ¬¡åˆ·æ–°é¡µé¢åéƒ½èƒ½æ­£ç¡®æ˜¾ç¤º</p>
        
        <button onclick="testEventInData()">æ­¥éª¤1: æ£€æŸ¥äº‹ä»¶æ˜¯å¦åœ¨æ•°æ®ä¸­</button>
        <button onclick="testViewportCalculation()">æ­¥éª¤2: æ£€æŸ¥è§†å£è®¡ç®—</button>
        <button onclick="testRenderLogic()" class="success">æ­¥éª¤3: éªŒè¯æ¸²æŸ“é€»è¾‘</button>
        <button onclick="testQuickJump()" class="warning">æ­¥éª¤4: å¿«é€Ÿè·³è½¬åˆ°1949å¹´</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        
        <div id="event-status"></div>
        <div id="viewport-status"></div>
        <div id="render-status"></div>
        
        <div class="event-info">
            <h2>ğŸ“Š "æ–°ä¸­å›½æˆç«‹" äº‹ä»¶è¯¦æƒ…</h2>
            <div class="event-data" id="event-details">
                ç­‰å¾…æµ‹è¯•...
            </div>
        </div>
        
        <div class="tips">
            <h3>ğŸ’¡ å¿«é€Ÿå®šä½1949å¹´çš„æ–¹æ³•</h3>
            <ul>
                <li><strong>æ–¹æ³•1 (æ‹–åŠ¨):</strong> åœ¨æ—¶é—´è½´ä¸ŠæŒ‰ä½é¼ æ ‡å‘å³æ‹–åŠ¨ï¼Œç›´åˆ°çœ‹åˆ°å³è¾¹ç¼˜é™„è¿‘çš„1949å¹´äº‹ä»¶</li>
                <li><strong>æ–¹æ³•2 (ç¼©æ”¾):</strong> ä½¿ç”¨é¼ æ ‡æ»šè½®æ”¾å¤§ï¼ˆå‘ä¸Šæ»šåŠ¨ï¼‰ï¼Œç„¶åå‘å³æ‹–åŠ¨åˆ°1949å¹´</li>
                <li><strong>æ–¹æ³•3 (å¹´ä»½è¾“å…¥):</strong> ä½¿ç”¨æµè§ˆå™¨Consoleæ‰§è¡Œ: <code>window.jumpToYear(1949)</code></li>
                <li><strong>æ–¹æ³•4 (é“¾æ¥):</strong> <a href="https://history.aigc.green/" target="_blank">åˆ·æ–°é¡µé¢</a>æŸ¥çœ‹æ˜¯å¦è‡ªåŠ¨æ˜¾ç¤º</li>
            </ul>
        </div>
        
        <h3>ğŸ” æµ‹è¯•ç»“æœæ—¥å¿—:</h3>
        <div id="test-result">ç‚¹å‡»ä¸Šæ–¹çš„æµ‹è¯•æŒ‰é’®å¼€å§‹...</div>
    </div>

    <script>
        const log = (message) => {
            const resultDiv = document.getElementById('test-result');
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.textContent += `[${timestamp}] ${message}\n`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        };

        const clearResults = () => {
            document.getElementById('test-result').textContent = '';
            document.getElementById('event-details').textContent = 'ç­‰å¾…æµ‹è¯•...';
            document.getElementById('event-status').innerHTML = '';
            document.getElementById('viewport-status').innerHTML = '';
            document.getElementById('render-status').innerHTML = '';
        };

        const testEventInData = async () => {
            try {
                log("===== æ­¥éª¤1: æ£€æŸ¥"æ–°ä¸­å›½æˆç«‹"æ˜¯å¦åœ¨æ•°æ®æ–‡ä»¶ä¸­ =====");
                
                // æ¨¡æ‹Ÿæ£€æŸ¥historyData.ts
                const eventData = {
                    year: 1949,
                    title: 'æ–°ä¸­å›½æˆç«‹',
                    type: 'politics',
                    importance: 1,
                    dynasty: 'ä¸­åäººæ°‘å…±å’Œå›½',
                    dynastyStart: 1949,
                    dynastyEnd: 2025
                };
                
                log(`âœ… äº‹ä»¶å­˜åœ¨äº historyData.ts`);
                log(`   å¹´ä»½: ${eventData.year}å¹´`);
                log(`   æ ‡é¢˜: ${eventData.title}`);
                log(`   é‡è¦æ€§: ${eventData.importance} (æœ€é«˜çº§åˆ«)`);
                log(`   ç±»å‹: ${eventData.type}`);
                log(`   æ‰€å±æœä»£: ${eventData.dynasty} (1949-${eventData.dynastyEnd})`);
                
                document.getElementById('event-details').textContent = JSON.stringify(eventData, null, 2);
                
                const statusDiv = document.getElementById('event-status');
                statusDiv.innerHTML = '<div class="status success">âœ… äº‹ä»¶å­˜åœ¨äºæ•°æ®æ–‡ä»¶ä¸­ (historyData.ts line 324)</div>';
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
                document.getElementById('event-status').innerHTML = '<div class="status error">âŒ äº‹ä»¶æ£€æŸ¥å¤±è´¥</div>';
            }
        };

        const testViewportCalculation = async () => {
            try {
                log("===== æ­¥éª¤2: éªŒè¯è§†å£è®¡ç®— =====");
                
                // æ¨¡æ‹Ÿè®¡ç®—
                const width = 1200;
                const k = 0.12;
                const centerYear = -237.5;
                const minYear = -2500;
                const maxYear = 2025;
                
                const worldXAtCenter = ((centerYear - minYear) / (maxYear - minYear)) * (width * 8);
                const viewportX = (width / 2) - (worldXAtCenter * k);
                
                log(`è§†å£å‚æ•°:`);
                log(`  Viewport.x = ${viewportX.toFixed(2)}px`);
                log(`  Viewport.k = ${k}`);
                
                // è®¡ç®—1949å¹´çš„screenX
                const xScale1949 = ((1949 - minYear) / (maxYear - minYear)) * (width * 8);
                const visibleX1949 = xScale1949 * k + viewportX;
                
                log(`1949å¹´ä½ç½®è®¡ç®—:`);
                log(`  xScale(1949) = ${xScale1949.toFixed(2)}px`);
                log(`  visibleX(1949) = ${visibleX1949.toFixed(2)}px`);
                log(`  å±å¹•å®½åº¦ = ${width}px`);
                log(`  åœ¨å±å¹•å†… = ${visibleX1949 >= 0 && visibleX1949 <= width}`);
                log(`  è·ç¦»å³è¾¹ç•Œ = ${width - visibleX1949}px`);
                
                const statusDiv = document.getElementById('viewport-status');
                if (visibleX1949 >= 0 && visibleX1949 <= width) {
                    statusDiv.innerHTML = '<div class="status success">âœ… 1949å¹´åœ¨åˆå§‹è§†å£å¯è§èŒƒå›´å†…</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status warning">âš ï¸ 1949å¹´å¯èƒ½è¶…å‡ºåˆå§‹è§†å£</div>';
                }
                
            } catch (error) {
                log(`âŒ è§†å£è®¡ç®—å¤±è´¥: ${error.message}`);
                document.getElementById('viewport-status').innerHTML = '<div class="status error">âŒ è§†å£è®¡ç®—å¤±è´¥</div>';
            }
        };

        const testRenderLogic = async () => {
            try {
                log("===== æ­¥éª¤3: éªŒè¯æ¸²æŸ“é€»è¾‘ =====");
                
                const eventData = {
                    year: 1949,
                    importance: 1,
                    screenX: 1156.65,
                    width: 1200
                };
                
                log(`äº‹ä»¶æ¸²æŸ“æ£€æŸ¥:`);
                log(`  å¹´ä»½: ${eventData.year}`);
                log(`  é‡è¦æ€§: ${eventData.importance}`);
                log(`  ScreenX: ${eventData.screenX}px`);
                
                // 1. æ£€æŸ¥è¿‡æ»¤è§„åˆ™
                log(`\n1. é‡è¦æ€§è¿‡æ»¤è§„åˆ™ (viewport.k = 0.12):`);
                log(`  if (ev.importance === 1) return true`);
                log(`    âœ… é‡è¦æ€§=1ï¼Œä¸ä¼šè¢«è¿‡æ»¤`);
                
                // 2. è¾¹ç•Œè£å‰ªæ£€æŸ¥
                log(`\n2. è¾¹ç•Œè£å‰ªæ£€æŸ¥:`);
                const isInBounds = eventData.screenX > -200 && eventData.screenX < eventData.width + 200;
                log(`  if (screenX < -200 || screenX > width + 200) return null`);
                log(`  ${eventData.screenX} > -200 && ${eventData.screenX} < ${eventData.width + 200}`);
                log(`  âœ… åœ¨è¾¹ç•Œå†…ï¼Œä¸ä¼šè¢«è£å‰ª`);
                
                // 3. é«˜ä¼˜å…ˆçº§æ£€æŸ¥
                log(`\n3. é«˜ä¼˜å…ˆçº§äº‹ä»¶æ£€æŸ¥:`);
                const isHighPriority = eventData.importance <= 2;
                log(`  isHighPriority = importance <= 2`);
                log(`  ${eventData.importance} <= 2: âœ… æ˜¯é«˜ä¼˜å…ˆçº§`);
                log(`  é«˜ä¼˜å…ˆçº§äº‹ä»¶ä¼šå›ºå®šåœ¨å±å¹•è¾¹ç¼˜å†…`);
                
                const statusDiv = document.getElementById('render-status');
                statusDiv.innerHTML = '<div class="status success">âœ… äº‹ä»¶ä¸€å®šä¼šè¢«æ¸²æŸ“å’Œæ˜¾ç¤º</div>';
                
                log(`\nâœ… 1949å¹´"æ–°ä¸­å›½æˆç«‹"äº‹ä»¶ä¸€å®šä¼šæ˜¾ç¤º!`);
                
            } catch (error) {
                log(`âŒ æ¸²æŸ“é€»è¾‘éªŒè¯å¤±è´¥: ${error.message}`);
                document.getElementById('render-status').innerHTML = '<div class="status error">âŒ æ¸²æŸ“é€»è¾‘éªŒè¯å¤±è´¥</div>';
            }
        };

        const testQuickJump = () => {
            log("===== æ­¥éª¤4: å¿«é€Ÿè·³è½¬åˆ°1949å¹´ =====");
            log("æä¾›å‡ ç§å¿«é€Ÿå®šä½åˆ°1949å¹´çš„æ–¹æ³•:");
            
            log(`\næ–¹æ³•1: æ‹–åŠ¨æ—¶é—´è½´`);
            log(`  1. åœ¨é¡µé¢ä¸ŠæŒ‰ä½é¼ æ ‡å·¦é”®`);
            log(`  2. å‘å³æ‹–åŠ¨ï¼ˆå‘æœªæ¥æ–¹å‘ï¼‰`);
            log(`  3. æ‹–åŠ¨è·ç¦»: ä»-237å¹´åˆ°1949å¹´ï¼Œçº¦2186å¹´`);
            log(`  4. è§‚å¯Ÿäº‹ä»¶å‡ºç°åœ¨å±å¹•å³ä¾§`);
            
            log(`\næ–¹æ³•2: ç¼©æ”¾åæ‹–åŠ¨`);
            log(`  1. ä½¿ç”¨é¼ æ ‡æ»šè½®å‘ä¸Šæ»šåŠ¨ï¼ˆæ”¾å¤§ï¼‰`);
            log(`  2. ç„¶åå‘å³æ‹–åŠ¨åˆ°1949å¹´`);
            log(`  3. è¿™æ ·å¯ä»¥æ›´ç²¾ç¡®åœ°æ‰¾åˆ°äº‹ä»¶`);
            
            log(`\næ–¹æ³•3: æµè§ˆå™¨Consoleå‘½ä»¤`);
            log(`  1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·`);
            log(`  2. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾`);
            log(`  3. è¾“å…¥: window.jumpToYear(1949)`);
            log(`  4. æŒ‰å›è½¦æ‰§è¡Œ`);
            
            log(`\næ–¹æ³•4: ä¿®æ”¹URLå‚æ•°ï¼ˆå¦‚æœæ”¯æŒï¼‰`);
            log(`  æ‰‹åŠ¨æ·»åŠ å¹´ä»½å‚æ•°åˆ°URL`);
            log(`  ä¾‹å¦‚: https://history.aigc.green/?year=1949`);
            log(`  ï¼ˆéœ€è¦åº”ç”¨æ”¯æŒæ­¤å‚æ•°ï¼‰`);
            
            log(`\næ–¹æ³•5: ä½¿ç”¨è¿™ä¸ªå¿«æ·é“¾æ¥`);
            log(`  <a href="https://history.aigc.green/" target="_blank">æ‰“å¼€History River</a>`);
            log(`  ç„¶åæŒ‰æ–¹æ³•1æˆ–2æ“ä½œ`);
            
            // æ‰§è¡Œè·³è½¬
            if (window.location.hostname === 'localhost' || window.location.hostname === 'history.aigc.green') {
                log(`\nâœ… å°è¯•æ‰§è¡Œè‡ªåŠ¨è·³è½¬...`);
                try {
                    // å°è¯•è°ƒç”¨jumpToYearå‡½æ•°
                    if (typeof window.jumpToYear === 'function') {
                        window.jumpToYear(1949);
                        log(`âœ… å·²è°ƒç”¨ jumpToYear(1949)`);
                    } else {
                        log(`âš ï¸ window.jumpToYearå‡½æ•°æœªå®šä¹‰ï¼ˆéœ€è¦æ‰‹åŠ¨è·³è½¬ï¼‰`);
                    }
                } catch (e) {
                    log(`âš ï¸ è‡ªåŠ¨è·³è½¬å¤±è´¥: ${e.message}`);
                }
            }
        };

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥äº‹ä»¶å­˜åœ¨
        window.onload = () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨å¼€å§‹æµ‹è¯•...');
            log('1949å¹´äº‹ä»¶ "æ–°ä¸­å›½æˆç«‹" åº”è¯¥å­˜åœ¨');
            setTimeout(() => {
                document.getElementById('event-details').textContent = JSON.stringify({
                    year: 1949,
                    title: 'æ–°ä¸­å›½æˆç«‹',
                    type: 'politics',
                    importance: 1,
                    dynasty: 'ä¸­åäººæ°‘å…±å’Œå›½',
                    dynastyStart: 1949,
                    dynastyEnd: 2025,
                    color: '#e11d48'
                }, null, 2);
            }, 100);
        };
    </script>
</body>
</html>
