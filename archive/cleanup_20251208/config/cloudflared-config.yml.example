# Cloudflare Tunnel 配置文件模板
# 使用说明：
# 1. 复制此文件到 ~/.cloudflared/config.yml
# 2. 替换 <TUNNEL_NAME> 为你的实际隧道名称（例如：history-river-dev）
# 3. 替换 <YOUR_USERNAME> 为你的 macOS 用户名
# 4. 替换 yourdomain.com 为你的实际 Cloudflare 域名

# 隧道名称（必须与创建时的名称一致）
tunnel: <TUNNEL_NAME>

# 凭证文件路径（cloudflared tunnel create 命令生成）
credentials-file: /Users/<YOUR_USERNAME>/.cloudflared/<TUNNEL_NAME>.json

# 入口规则配置
ingress:
  # ============================================
  # 前端应用 (Vite 开发服务器)
  # ============================================
  - hostname: frontend.yourdomain.com
    service: http://localhost:3000
    originRequest:
      # 禁用 TLS 验证（本地开发）
      noTLSVerify: true
      # 连接超时
      connectTimeout: 30s
      # 保持连接
      keepAliveConnections: 100
      # HTTP/2 支持
      http2Origin: true

  # ============================================
  # Express API 服务器 (AI 内容生成)
  # ============================================
  - hostname: api.yourdomain.com
    service: http://localhost:4000
    originRequest:
      noTLSVerify: true
      connectTimeout: 30s
      keepAliveConnections: 100
      http2Origin: true

  # ============================================
  # Django 后端 (Timeline API)
  # ============================================
  - hostname: timeline.yourdomain.com
    service: http://localhost:8000
    originRequest:
      noTLSVerify: true
      connectTimeout: 30s
      keepAliveConnections: 100
      http2Origin: true

  # ============================================
  # 默认路由（必须保留，处理未匹配的请求）
  # ============================================
  - service: http_status:404

# ============================================
# 全局配置（可选）
# ============================================

# 日志级别: debug, info, warn, error
loglevel: info

# 传输日志
transport-loglevel: warn

# 重试次数
retries: 5

# 优雅关闭超时
grace-period: 30s

# 压缩
compression-quality: 0

# 禁用自动更新
no-autoupdate: false

# ============================================
# 高级配置示例（按需启用）
# ============================================

# # WebSocket 支持
# warp-routing:
#   enabled: true

# # 指标和监控
# metrics: localhost:2000

# # 协议优化
# protocol: quic

# # 区域选择（自动选择最近的 Cloudflare 数据中心）
# region: auto

# ============================================
# 使用说明
# ============================================
# 
# 1. 安装 cloudflared:
#    brew install cloudflare/cloudflare/cloudflared
#
# 2. 认证:
#    cloudflared tunnel login
#
# 3. 创建隧道:
#    cloudflared tunnel create history-river-dev
#
# 4. 复制此配置文件:
#    cp cloudflared-config.yml.example ~/.cloudflared/config.yml
#
# 5. 编辑配置文件，替换占位符:
#    - <TUNNEL_NAME> -> history-river-dev
#    - <YOUR_USERNAME> -> 你的 macOS 用户名
#    - yourdomain.com -> 你的实际域名
#
# 6. 配置 DNS:
#    cloudflared tunnel route dns history-river-dev frontend.yourdomain.com
#    cloudflared tunnel route dns history-river-dev api.yourdomain.com
#    cloudflared tunnel route dns history-river-dev timeline.yourdomain.com
#
# 7. 启动隧道:
#    cloudflared tunnel run history-river-dev
#
# ============================================

