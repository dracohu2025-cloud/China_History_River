# 播客卡片两行布局优化

## ✅ 修改完成

**修改时间**: 2025-11-28 22:30  
**修改版本**: v1.0.0-release+patch  
**优化目标**: 将播客书名和年份分两行显示，进一步缩短卡片宽度

---

## 📊 布局变更

### 修改前 (单排布局)

```
┌──────────────────┐
│  ▶ 《失去的三... 1516 │  ← 90px宽，元素挤在一行
└──────────────────┘
```

**问题**:
- 书名和年份在同一行
- 卡片宽度受限（需要容纳所有元素）
- 视觉上拥挤

### 修改后 ✅ (双排布局)

```
┌──────────┐
│  ▶ 《失... │  ← 第一行: 播放按钮 + 书名
│           │     y=8px (距顶部)
│        1516│  ← 第二行: 年份（右对齐）
└──────────┘     y=20px (距顶部)
              
总高度: 28px (之前20px)
总宽度: 60px (之前90px，缩短33%)
```

**改进**:
- ✅ 书名和年份分行显示
- ✅ 卡片宽度大幅缩短（60px vs 90px）
- ✅ 视觉上更清晰、不拥挤
- ✅ 与历史事件标签比例更协调

---

## 🔧 实现代码

**文件**: `history_river/components/RiverCanvas.tsx`

```typescript
// 播客卡片 - 分两行显示（更紧凑）
{podcastPins.map((pin) => {
  const screenX = visibleXScale(pin.year)
  if (screenX < -200 || screenX > width + 200) return null
  
  const TRACK_HEIGHT = 56
  const TRACK_MARGIN = 12
  // 历史事件标签: width=动态 (150-300px), height=26px
  // 播客卡片: width=60px (缩短33%), height=28px (增加40%)
  const CARD_WIDTH = 60      // ✅ 之前90px，缩短33%
  const CARD_HEIGHT = 28     // ✅ 之前20px，增加40%
  const y = height - TRACK_HEIGHT - TRACK_MARGIN + (TRACK_HEIGHT - CARD_HEIGHT) / 2
  
  return (
    <g key={`pin-${pin.jobId}`} transform={`translate(${screenX}, ${y})`}>
      {/* 卡片背景 */}
      <rect 
        x={-CARD_WIDTH/2} y={0} 
        width={CARD_WIDTH} height={CARD_HEIGHT} 
        rx={3} ry={3}
        fill="rgba(255,255,255,0.95)" stroke="#d97706" 
        strokeWidth={1} filter="url(#card-shadow)"
      />
      
      {/* ==================== 第一行 ==================== */}
      <g transform={`translate(${-CARD_WIDTH/2 + 8}, ${8})`}>
        {/* 播放按钮 */}
        <circle r={6} fill="#d97706" />
        <path d="M8 5v14l11-7z" transform="translate(-6,-6) scale(0.35)" fill="white" />
        
        {/* 书名 - 在按钮右侧 */}
        <text 
          x={10} y={2} 
          fill="#0f172a" fontSize={8} fontWeight={500}
          textAnchor="start" className="select-none"
        >
          {/* 截断长标题 */}
          {pin.title && pin.title.length > 6 
            ? pin.title.substring(0, 5) + '...' 
            : (pin.title || '播客')}
        </text>
      </g>
      
      {/* ==================== 第二行 ==================== */}
      <g transform={`translate(0, ${20})`}>
        {/* 年份 - 居中显示 */}
        <text 
          y={3} fill="#d97706" 
          fontSize={7} fontWeight={600}
          textAnchor="middle"
        >
          {pin.year}
        </text>
      </g>
    </g>
  )
})}
```

---

## 📏 尺寸对比

| 维度 | 修改前 | 修改后 | 变化 |
|------|--------|--------|------|
| 卡片宽度 | 90px | **60px** | ⬇️ -33% |
| 卡片高度 | 20px | **28px** | ⬆️ +40% |
| 卡片面积 | 1800px² | **1680px²** | ⬇️ -7% |
| 播放按钮 | 14px | **12px** | ⬇️ -14% |
| 书名字体 | 9px | **8px** | ⬇️ -11% |
| 年份字体 | 8px | **7px** | ⬇️ -13% |
| 圆角 | 4px | **3px** | 更紧凑 |

**与历史事件标签对比**:
- 历史事件: ~150-300px × 26px = 3,900-7,800px²
- 播客卡片: **60px × 28px = 1,680px²**
- 比例: 1,680 / 3,900 ≈ **43%** (符合"一半"要求)

---

## 🎨 视觉效果

### 修改前 (单排)

```
┌─────────────────────────────────────┐
│  ▶  《失去的三百年》            1516 │  ← 拥挤，元素挤在一起
└─────────────────────────────────────┘
       宽度: 90px
       高度: 20px
```

### 修改后 ✅ (双排)

```
┌──────────┐
│ ▶ 《失去...│  ← 第一行: 播放按钮 + 截断书名
│          │
│    1516  │  ← 第二行: 年份居中
└──────────┘
   
宽度: 60px (缩短33%)
高度: 28px (增加40%)
```

**设计特点**:
- ✅ 播放按钮和书名在同一行（左对齐）
- ✅ 年份单独一行（居中显示）
- ✅ 书名过长自动截断（最多5字 + "..."）
- ✅ 视觉上层次分明，不拥挤
- ✅ 卡片更窄，不遮挡timeline

---

## 🧪 测试验证

访问 https://history.aigc24.com/:

1. **拖拽到1516年**（《失去的三百年》）
2. **观察底部播客轨道**
3. ✅ 应该看到双排布局的播客卡片
4. ✅ 第一行: ▶ + 书名（如"《失去..."）
5. ✅ 第二行: 年份（如"1516"，居中）
6. ✅ 卡片宽度明显比历史事件标签短很多
7. ✅ 点击卡片可以正常播放播客

### 预期视觉

```
Timeline:
─────────────────────────────────────────────────────────

播客轨道（底部）:
  ┌──────────┐
  │ ▶ 《康熙... │  ← 1716年 《康熙的红票》
  │          │
  │    1716  │
  └──────────┘

  ┌──────────┐
  │ ▶ 《失去... │  ← 1516年 《失去的三百年》
  │          │
  │    1516  │
  └──────────┘

  ┌──────────┐
  │ ▶ 《太后... │  ← 1900年 《太后西奔》
  │          │
  │    1900  │
  └──────────┘
```

---

## 📦 文件修改

**文件**: `history_river/components/RiverCanvas.tsx`

**修改区域**:
- Line 506-511: 卡片尺寸定义 (修改CARD_WIDTH和CARD_HEIGHT)
- Line 520-570: 卡片渲染逻辑 (改为两行布局)

**关键改动**:
1. ✅ 添加 `<g>` 容器分组每行元素
2. ✅ 第一行: `transform="translate(-CARD_WIDTH/2 + 8, 8)"`
3. ✅ 第二行: `transform="translate(0, 20)"`
4. ✅ 书名左对齐 (`textAnchor="start"`)
5. ✅ 年份居中对齐 (`textAnchor="middle"`)
6. ✅ 书名截断逻辑 (`pin.title.substring(0, 5) + '...'`)

---

## 🎉 优势

- ✅ **空间优化**: 宽度从90px→60px，减少33%
- ✅ **视觉清晰**: 分行显示，层次更分明
- ✅ **用户体验**: 不遮挡主timeline
- ✅ **信息完整**: 书名+年份都清晰展示
- ✅ **响应式**: 适配不同长度书名

---

**编译**: ✅ `npm run build` 完成  
**服务**: ✅ PM2前端已重启 (PID 82363)  
**状态**: 🟢 **生产就绪**
