# Nginx配置示例 - Django Admin管理后台
# 
# 由于现有前端已经使用 /admin 路径, 推荐以下两种配置方式:
# 
# 方式1: 使用子域名 (推荐)
# 访问地址: https://admin.history.aigc.green/admin/
# 
# 方式2: 使用独立路径
# 访问地址: https://history.aigc.green/django-admin/admin/
# 
# 根据实际情况选择其中一种配置

# ============================================================================
# 方式1: 子域名配置 (推荐)
# ============================================================================

# server {
#     listen 80;
#     server_name admin.history.aigc.green;
#     
#     # SSL配置 (如果使用HTTPS)
#     # listen 443 ssl http2;
#     # ssl_certificate /path/to/cert.pem;
#     # ssl_certificate_key /path/to/key.pem;
#     
#     client_max_body_size 10M;
#     
#     # 静态文件
#     location /static/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/staticfiles/;
#         expires 30d;
#         add_header Cache-Control "public, immutable";
#     }
#     
#     location /media/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/media/;
#         expires 7d;
#     }
#     
#     # Django Admin
#     location / {
#         proxy_pass http://127.0.0.1:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_connect_timeout 30s;
#         proxy_read_timeout 30s;
#     }
# }


# ============================================================================
# 方式2: 独立路径配置
# ============================================================================

# server {
#     listen 80;
#     server_name history.aigc.green;
#     
#     # 原有的前端配置
#     location / {
#         # ... 现有的前端配置 ...
#     }
#     
#     # 现有的React Admin (保留)
#     location /admin {
#         alias /home/ubuntu/history_river/history_river/admin.html;
#     }
#     
#     # Django Admin (新增加)
#     location /django-admin/ {
#         proxy_pass http://127.0.0.1:8000/admin/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         
#         # 处理静态文件的代理
#         sub_filter 'src="/static/' 'src="/django-admin/static/';
#         sub_filter 'href="/static/' 'href="/django-admin/static/';
#         sub_filter 'action="/admin/' 'action="/django-admin/admin/';
#         sub_filter 'window.location = "/admin/' 'window.location = "/django-admin/admin/';
#         sub_filter_types *;
#         sub_filter_once off;
#     }
#     
#     # Django静态文件
#     location /django-admin/static/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/staticfiles/;
#         expires 30d;
#         add_header Cache-Control "public, immutable";
#     }
#     
#     location /django-admin/media/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/media/;
#         expires 7d;
#     }
# }


# ============================================================================
# 方式3: 独立端口配置 (最简单)
# ============================================================================
# 
# 如果有条件开启新端口(如8080),可以直接使用:
# 
# server {
#     listen 8080;
#     server_name history.aigc.green;
#     
#     # 静态文件
#     location /static/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/staticfiles/;
#         expires 30d;
#     }
#     
#     location /media/ {
#         alias /home/ubuntu/history_river/history_river/dj_backend/media/;
#         expires 7d;
#     }
#     
#     location / {
#         proxy_pass http://127.0.0.1:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }
# 
# 访问: https://history.aigc.green:8080/admin/
# ============================================================================


# ============================================================================
# 建议的配置实施步骤 (UCloud生产环境)
# ============================================================================
# 
# 1. 在UCloud服务器上:
#    cd /home/ubuntu/history_river/history_river/dj_backend
# 
# 2. 安装Python依赖:
#    pip install -r requirements.txt
# 
# 3. 配置环境变量:
#    cp .env.example .env
#    vim .env  # 填写Supabase数据库信息
# 
# 4. 数据库迁移:
#    dotenv run python manage.py migrate
# 
# 5. 创建管理员账户:
#    dotenv run python manage.py createsuperuser
# 
# 6. 生产启动 (方式2推荐):
#    ./start_prod.sh
#    # 或使用PM2:
#    pm2 start "dotenv run gunicorn -c gunicorn_config.py dj_backend.wsgi:application" --name django-admin
# 
# 7. 配置Nginx (选择一种方式)
#    推荐使用 方式1 (子域名) 或 方式2 (独立路径)
#    sudo cp nginx_django.conf /etc/nginx/sites-available/
#    sudo vim /etc/nginx/sites-available/default
#    sudo nginx -t && sudo systemctl reload nginx
# 
# 8. 验证访问:
#    curl http://127.0.0.1:8000/admin/  # 直接访问Gunicorn
#    curl https://history.aigc.green/django-admin/admin/  # 通过Nginx
# 
# ============================================================================

# 说明: 此文件为配置示例,请根据实际环境修改路径和参数
# 更新时间: 2025-11-25
