# UCloud生产环境部署指南

## 环境要求

- Ubuntu 20.04+/CentOS 8+
- Python 3.9+
- PostgreSQL 14+(已有Supabase)
- Nginx/Apache(反向代理)
- PM2(进程管理,可选)

## 部署步骤

### 1. 准备环境

```bash
# 进入项目目录
cd /home/ubuntu/history_river/history_river/dj_backend

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置环境变量

```bash
# 复制配置文件
cp .env.example .env

# 编辑配置
vim .env
```

填写以下关键配置:

```bash
# Django
DJANGO_SECRET_KEY=your-secret-key-here-min-50-chars-long-for-production
DJANGO_DEBUG=False
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,history.aigc.green,hisotry.aigc.green

# Supabase PostgreSQL (从现有的.env.local中提取)
SUPABASE_DB_HOST=db.xxx.supabase.co
SUPABASE_DB_PORT=5432
SUPABASE_DB_NAME=postgres
SUPABASE_DB_USER=postgres
SUPABASE_DB_PASSWORD=password-from-supabase

# OpenRouter API (可选)
OPENROUTER_API_KEY=key-from-env-file
```

### 3. 数据库迁移

```bash
source venv/bin/activate

# 运行迁移
python manage.py makemigrations
dotenv run python manage.py migrate

# 创建管理用户
dotenv run python manage.py createsuperuser
# 按提示输入用户名、邮箱、密码
```

### 4. 配置和启动服务




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































